ğŸ“ Directory structure for './kustomize'
./kustomize
â”œâ”€â”€ apps
â”‚Â Â  â”œâ”€â”€ space
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ base
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ kustomization.yaml
â”‚Â Â  â”‚Â Â  â””â”€â”€ overlays
â”‚Â Â  â”‚Â Â      â”œâ”€â”€ dev
â”‚Â Â  â”‚Â Â      â”‚Â Â  â””â”€â”€ kustomization.yaml
â”‚Â Â  â”‚Â Â      â””â”€â”€ pre
â”‚Â Â  â”‚Â Â          â””â”€â”€ kustomization.yaml
â”‚Â Â  â””â”€â”€ world
â”‚Â Â      â”œâ”€â”€ base
â”‚Â Â      â”‚Â Â  â””â”€â”€ kustomization.yaml
â”‚Â Â      â””â”€â”€ overlays
â”‚Â Â          â”œâ”€â”€ dev
â”‚Â Â          â”‚Â Â  â””â”€â”€ kustomization.yaml
â”‚Â Â          â””â”€â”€ pre
â”‚Â Â              â””â”€â”€ kustomization.yaml
â””â”€â”€ components
    â”œâ”€â”€ carbone
    â”‚Â Â  â””â”€â”€ base
    â”‚Â Â      â”œâ”€â”€ helmrelease.yaml
    â”‚Â Â      â”œâ”€â”€ kustomization.yaml
    â”‚Â Â      â””â”€â”€ values.yaml
    â”œâ”€â”€ helloworld
    â”‚Â Â  â””â”€â”€ base
    â”‚Â Â      â”œâ”€â”€ helmrelease.yaml
    â”‚Â Â      â”œâ”€â”€ kustomization.yaml
    â”‚Â Â      â””â”€â”€ values.yaml
    â”œâ”€â”€ moon
    â”‚Â Â  â””â”€â”€ base
    â”‚Â Â      â”œâ”€â”€ helmrelease.yaml
    â”‚Â Â      â”œâ”€â”€ kustomization.yaml
    â”‚Â Â      â””â”€â”€ values.yaml
    â”œâ”€â”€ sun
    â”‚Â Â  â””â”€â”€ base
    â”‚Â Â      â”œâ”€â”€ helmrelease.yaml
    â”‚Â Â      â”œâ”€â”€ kustomization.yaml
    â”‚Â Â      â””â”€â”€ values.yaml
    â””â”€â”€ world
        â””â”€â”€ base
            â”œâ”€â”€ helmrelease.yaml
            â”œâ”€â”€ kustomization.yaml
            â””â”€â”€ values.yaml

23 directories, 21 files

ğŸ“„ File contents within './kustomize' (recursive)

==== ./kustomize/components/carbone/base/values.yaml ====
# kustomize/components/carbone/base/values.yaml
serviceName: carbone
image: andres20980/carbone-ee-docker:latest
replicas: 1
service:
  type: ClusterIP
  port: 80
ingress:
  enabled: false

==== ./kustomize/components/carbone/base/kustomization.yaml ====
# kustomize/components/carbone/base/kustomization.yaml
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- helmrelease.yaml

configMapGenerator:
- files:
  - values.yaml
  name: carbone-values

patches:
- patch: |-
    - op: replace
      path: /spec/chart/spec/chart
      value: ./helm-base
    - op: replace
      path: /spec/chart/spec/sourceRef/kind
      value: GitRepository
    - op: replace
      path: /spec/chart/spec/sourceRef/name
      value: gitops-poc-repo # Replace with your actual Flux GitRepository name if different
    - op: replace
      path: /spec/valuesFrom/0/sourceRef/name
      value: carbone-values
  target:
    group: helm.toolkit.fluxcd.io
    kind: HelmRelease
    name: carbone
    version: v2beta1

==== ./kustomize/components/carbone/base/helmrelease.yaml ====
# kustomize/components/carbone/base/helmrelease.yaml
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: carbone # This name will be prefixed/suffixed by Kustomize higher up
spec:
  interval: 1m
  chart:
    spec:
      chart: placeholder # This will be patched
      sourceRef:
        kind: GitRepository
        name: placeholder # This will be patched
  valuesFrom:
    - kind: ConfigMap
      name: placeholder # This will be patched

==== ./kustomize/components/sun/base/values.yaml ====
# kustomize/components/sun/base/values.yaml
serviceName: sun
image: your-repo/sun-service:latest # Placeholder for sun image
replicas: 1
service:
  type: ClusterIP
  port: 80
ingress:
  enabled: false

==== ./kustomize/components/sun/base/kustomization.yaml ====
# kustomize/components/sun/base/kustomization.yaml
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- helmrelease.yaml

configMapGenerator:
- files:
  - values.yaml
  name: sun-values

patches:
- patch: |-
    - op: replace
      path: /spec/chart/spec/chart
      value: ./helm-base
    - op: replace
      path: /spec/chart/spec/sourceRef/kind
      value: GitRepository
    - op: replace
      path: /spec/chart/spec/sourceRef/name
      value: gitops-poc-repo # Replace with your actual Flux GitRepository name if different
    - op: replace
      path: /spec/valuesFrom/0/sourceRef/name
      value: sun-values
  target:
    group: helm.toolkit.fluxcd.io
    kind: HelmRelease
    name: sun
    version: v2beta1

==== ./kustomize/components/sun/base/helmrelease.yaml ====
# kustomize/components/sun/base/helmrelease.yaml
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: sun
spec:
  interval: 1m
  chart:
    spec:
      chart: placeholder
      sourceRef:
        kind: GitRepository
        name: placeholder
  valuesFrom:
    - kind: ConfigMap
      name: placeholder

==== ./kustomize/components/helloworld/base/values.yaml ====
# kustomize/components/helloworld/base/values.yaml
serviceName: helloworld
image: andres20980/helloworld-app:latest
replicas: 1
service:
  type: ClusterIP
  port: 80
ingress:
  enabled: false

==== ./kustomize/components/helloworld/base/kustomization.yaml ====
# kustomize/components/helloworld/base/kustomization.yaml
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- helmrelease.yaml

configMapGenerator:
- files:
  - values.yaml
  name: helloworld-values

patches:
- patch: |-
    - op: replace
      path: /spec/chart/spec/chart
      value: ./helm-base
    - op: replace
      path: /spec/chart/spec/sourceRef/kind
      value: GitRepository
    - op: replace
      path: /spec/chart/spec/sourceRef/name
      value: gitops-poc-repo # Replace with your actual Flux GitRepository name if different
    - op: replace
      path: /spec/valuesFrom/0/sourceRef/name
      value: helloworld-values
  target:
    group: helm.toolkit.fluxcd.io
    kind: HelmRelease
    name: helloworld
    version: v2beta1

==== ./kustomize/components/helloworld/base/helmrelease.yaml ====
# kustomize/components/helloworld/base/helmrelease.yaml
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: helloworld
spec:
  interval: 1m
  chart:
    spec:
      chart: placeholder
      sourceRef:
        kind: GitRepository
        name: placeholder
  valuesFrom:
    - kind: ConfigMap
      name: placeholder

==== ./kustomize/components/moon/base/values.yaml ====
# kustomize/components/moon/base/values.yaml
serviceName: moon
image: your-repo/moon-service:latest # Placeholder for moon image
replicas: 1
service:
  type: ClusterIP
  port: 80
ingress:
  enabled: false

==== ./kustomize/components/moon/base/kustomization.yaml ====
# kustomize/components/moon/base/kustomization.yaml
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- helmrelease.yaml

configMapGenerator:
- files:
  - values.yaml
  name: moon-values

patches:
- patch: |-
    - op: replace
      path: /spec/chart/spec/chart
      value: ./helm-base
    - op: replace
      path: /spec/chart/spec/sourceRef/kind
      value: GitRepository
    - op: replace
      path: /spec/chart/spec/sourceRef/name
      value: gitops-poc-repo # Replace with your actual Flux GitRepository name if different
    - op: replace
      path: /spec/valuesFrom/0/sourceRef/name
      value: moon-values
  target:
    group: helm.toolkit.fluxcd.io
    kind: HelmRelease
    name: moon
    version: v2beta1

==== ./kustomize/components/moon/base/helmrelease.yaml ====
# kustomize/components/moon/base/helmrelease.yaml
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: moon
spec:
  interval: 1m
  chart:
    spec:
      chart: placeholder
      sourceRef:
        kind: GitRepository
        name: placeholder
  valuesFrom:
    - kind: ConfigMap
      name: placeholder

==== ./kustomize/components/world/base/values.yaml ====
# kustomize/components/world/base/values.yaml
serviceName: world
image: your-repo/world-service:latest # Placeholder for world image
replicas: 1
service:
  type: ClusterIP
  port: 80
ingress:
  enabled: false

==== ./kustomize/components/world/base/kustomization.yaml ====
# kustomize/components/world/base/kustomization.yaml
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- helmrelease.yaml

configMapGenerator:
- files:
  - values.yaml
  name: world-values

patches:
- patch: |-
    - op: replace
      path: /spec/chart/spec/chart
      value: ./helm-base
    - op: replace
      path: /spec/chart/spec/sourceRef/kind
      value: GitRepository
    - op: replace
      path: /spec/chart/spec/sourceRef/name
      value: gitops-poc-repo # Replace with your actual Flux GitRepository name if different
    - op: replace
      path: /spec/valuesFrom/0/sourceRef/name
      value: world-values
  target:
    group: helm.toolkit.fluxcd.io
    kind: HelmRelease
    name: world
    version: v2beta1

==== ./kustomize/components/world/base/helmrelease.yaml ====
# kustomize/components/world/base/helmrelease.yaml
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: world
spec:
  interval: 1m
  chart:
    spec:
      chart: placeholder
      sourceRef:
        kind: GitRepository
        name: placeholder
  valuesFrom:
    - kind: ConfigMap
      name: placeholder

==== ./kustomize/apps/space/base/kustomization.yaml ====
# kustomize/apps/space/base/kustomization.yaml
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- ../../../components/world/base
- ../../../components/sun/base
- ../../../components/moon/base
- ../../../components/carbone/base


patches:
- patch: |-
    - op: replace
      path: /metadata/name
      value: space-world
  target:
    kind: HelmRelease
    name: world
- patch: |-
    - op: replace
      path: /metadata/name
      value: space-sun
  target:
    kind: HelmRelease
    name: sun
- patch: |-
    - op: replace
      path: /metadata/name
      value: space-moon
  target:
    kind: HelmRelease
    name: moon
- patch: |-
    - op: replace
      path: /metadata/name
      value: space-carbone
  target:
    kind: HelmRelease
    name: carbone
labels:
- includeSelectors: true
  pairs:
    app: space-app

==== ./kustomize/apps/space/overlays/pre/kustomization.yaml ====
# kustomize/apps/space/overlays/pre/kustomization.yaml
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- ../../base

namespace: space-pre

patches:
- patch: |-
    - op: replace
      path: /spec/values/ingress/enabled
      value: true
    - op: replace
      path: /spec/values/ingress/host
      value: world-pre.space.example.com
  target:
    kind: HelmRelease
    name: space-world

==== ./kustomize/apps/space/overlays/dev/kustomization.yaml ====
# kustomize/apps/space/overlays/dev/kustomization.yaml
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- ../../base

namespace: space-dev

patches:
- patch: |-
    - op: replace
      path: /spec/values/ingress/enabled
      value: true
    - op: replace
      path: /spec/values/ingress/host
      value: world-dev.space.example.com
  target:
    kind: HelmRelease
    name: space-world

==== ./kustomize/apps/world/base/kustomization.yaml ====
# kustomize/apps/world/base/kustomization.yaml
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- ../../../components/helloworld/base
- ../../../components/moon/base
- ../../../components/carbone/base


patches:
- patch: |-
    - op: replace
      path: /metadata/name
      value: world-helloworld
  target:
    kind: HelmRelease
    name: helloworld
- patch: |-
    - op: replace
      path: /metadata/name
      value: world-moon
  target:
    kind: HelmRelease
    name: moon
- patch: |-
    - op: replace
      path: /metadata/name
      value: world-carbone
  target:
    kind: HelmRelease
    name: carbone
labels:
- includeSelectors: true
  pairs:
    app: world-app

==== ./kustomize/apps/world/overlays/pre/kustomization.yaml ====
# kustomize/apps/world/overlays/pre/kustomization.yaml
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- ../../base

namespace: world-pre

patches:
- patch: |-
    - op: replace
      path: /spec/values/ingress/enabled
      value: true
    - op: replace
      path: /spec/values/ingress/host
      value: helloworld-pre.world.example.com
  target:
    kind: HelmRelease
    name: world-helloworld

==== ./kustomize/apps/world/overlays/dev/kustomization.yaml ====
# kustomize/apps/world/overlays/dev/kustomization.yaml
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- ../../base

namespace: world-dev

patches:
- patch: |-
    - op: replace
      path: /spec/values/ingress/enabled
      value: true
    - op: replace
      path: /spec/values/ingress/host
      value: helloworld-dev.world.example.com
  target:
    kind: HelmRelease
    name: world-helloworld
